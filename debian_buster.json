{
  "variables": {
    "docker_user": "{{ env `DOCKER_USER`}}",
    "docker_password": "{{ env `DOCKER_PASSWORD`}}"
  },
  "builders": [
    {
      "type": "docker",
      "image": "debian:buster-slim",
      "commit": true,
      "changes": [
        "LABEL maintainer=\"Jeremie CUADRADO\"",
        "VOLUME /sys/fs/cgroup",
        "CMD [\"/lib/systemd/systemd\"]"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "build-systemd.sh"
    },{
      "type": "shell",
      "script": "add_python3.sh"
    },
    {
      "type": "ansible",
      "user": "root",
      "galaxy_file": "requirements.yml",
      "playbook_file": "provision.yml"
    }
  ],
  "post-processors": [
	[
	  	{
  		"type": "docker-tag",
  		"repository": "redbeard28/debian",
  		"tag": "buster-basetools"
		},
		{
		"type": "docker-push",
		"login_username": "{{ user `docker_user`}}",
		"login_password": "{{ user `docker_password`}}",
		"login": true
		}
	]
  ]
}
